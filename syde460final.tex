% vim: tw=80 et sw=4
\documentclass{sydeStyle}
\usepackage{amsmath}
\usepackage{amssymb}
% \usepackage{graphicx}
\usepackage{longtable}

\coursecode{462}
\prof{Professor Stashuk}
\title{
Design of an Autonomous Hang-Glider Controller - Final Report
}
\date{\today}

\author{Andrew Cameron, 20252410}
\authorthree{Peter Lobsinger, 20195824}

\begin{document}
%TODO: describe all symbols, possibly in a Table of Symbols.

\maketitle

\tableofcontents

\chapter{Introduction}
% This should introduce the topic in a manner understandable by anyone with a
% reasonable technical background (i.e. any 1st year engineering student should
% be able to understand the problem). Identify the need or problem that you want
% to address and why you want to address it. Indicate why and to whom the
% problem is important.  Background information should motivate the need for the
% design and show the nature, extent or significance of the problem you have
% defined.  This can be done, for example, by identifying inadequacies in
% existing designs, demonstrating an industry need for such an implementation,
% or reviewing existing research on the topic.  These three aspects
% (Introduction, Background and Problem Statement) can be organized in separate
% sections, or all together, etc. in order to suit the readability for your
% particular workshop.

The competition in which the Waterloo Rocketry Team (WRT) aims to compete has a
component of the score determined by functionality and innovation of the
payload\cite{IREC}. The WRT spawned several payload projects with the aim of
achieving a good standing in this category. One such project was a
rocket-deployed glider, which launches at apogee.

The preferred design for the glider was the Parasev. A Parasev consists of a
wing suspending a control mass\cite{wiki:parasev}. The wing is a high-sweepback
delta wing composed of sailcloth held loosely to a frame which defines the
leading edges and a central keel. The craft is navigated by positioning the wing
at an offset from the control mass, generating moments which change the craft's
orientation.

4A Mechanical Engineering student, Gandhali Joshi, undertook the mechanical
design of this glider as her fourth year design project. The control of the
craft, however, was not a component of this project.

The all components of the rocket and payload must be recovered within a 2 hour
window. Teams failing to comply with this regulation face disqualification from
the competition \cite{IREC}. This project was undertaken to design a control
system for this glider that would facilitate the recovery of the craft.

\chapter{Objectives}
% The objectives should not have changed in principle from the Design Plan and
% Interim Report, however, you may want to rework them to ensure that they fit
% in with the rest of the report.  Do not discuss why objectives may have been
% reworked here; this should be saved for the “Description of Time-Line” section
% (described below).

The launch of the glider from the rocket is the responsibility of the rocketry
team. The glider will be launched to a state that is suitable for flight and
clear of all components of the rocket.

\section{Maintain Flight}
\label{sec:obj1}

The control system must ensure that the craft remains in stable flight through
the duration of its control, that is, from the end of the glider launch sequence
to the landing. To ensure that this objective is feasible, no considerations are
made for meteorological conditions. It is assumed that the craft flies through
windless, constant-density air.

\section{Fly to Target}
\label{sec:obj2}

In order to make recovery as convenient as possible, the primary objective of
the craft's control system is to arrive at a predetermined point on the ground,
specifically, the launch area, or a neighbouring location.

This objective is only feasible for a range of initial conditions. Fortunately,
the rocket launch provides a relatively narrow range of initial conditions. The
apex of the flights of the rocket under consideration will range from between
2~km and 5~km above ground level, with lateral displacement less than 1~km. Up
to 1~s of freefall before deployment gives 0~m/s to 9.8~m/s initial downward
velocity. Between 0.5~m/s and 3~m/s lateral speed are expected at the apex of
the rocket's flight, and are therefore the initial condition's ground speed
range. The assumption that the deployment procedure will position the craft in
a state favourable to flight can be formalized to an orientation that gives
between 0 and 30 degrees angle of attack, no sideslip, and zero angle rates.

\section{Land Safely}

Recoverability and reusability, important objectives for the WRT, depend heavily
on a graceful landing. Moderate impact shocks are acceptable for an unmanned
craft designed with rough landings in mind. The control system will arrange for
the craft to hit the ground within acceptable bounds for the designed glider.

\chapter{Methodology}
% Criteria (measurable qualities) and constraints (hard decisions) should be
% provided to guide the design process and motivate preferred solutions.  The
% extent of the use of criteria and constraints is project dependent.  The
% design group should provide sufficient information in this section to fully
% justify the methods used.

\section{Modelling of Craft Dynamics}
\label{sec:modelling}
% Since you model lift and drag forces and so on, it's my understanding that it
% counts as 'dynamics'.  But you're the expert, so if you want to change the
% title, that's your prerogative! =)

In order to gain insight into craft behaviour and to evaluate controller
performance, a model of the dynamics of the craft was created based on existing
work \cite{Rogallo1960}\cite{Layton1963}\cite{spottiswoode}. A set of simulation
and visualization software tools were created based on this model.

\subsection{Simplifying Assumptions}

In order to create a simple model demonstrating the interesting, long-term
behaviour of the craft, a number of simplifications were made.

The craft was modelled as a single body, about the center of mass of the overall
system. This eliminates the requirement of considering forces internal to the
system, reducing the number of forces needing consideration. However, not
considering internal forces does entail neglecting some components of the
dynamics, leading to further assumptions being forced.

The control mass is assumed to move instantaneously to any commanded position.
This is clearly not physical, however, the control mass is moved using torques
at the hang point, which are some of the internal forces that have been omitted
from the model due to the single-body assumption. Due to the smoothness of
flight of real craft resembling the one being modelled, it is expected that the
control mass will be moved slowly and that, under these slow actuation
conditions, a real motor would be able to accomplish the desired position nearly
instantly, as compared to other aspects of the craft dynamics.

Another result of not modelling the control torques moving the control mass is
that the accelerations due to these cannot be modelled. This means that changes
in control mass position do not result in changes in wing orientation, as would
normally occur in a real craft. This unmodelled effect results in slight
transients in wing position response to control inputs. To the controller, this
unanticipated effect is simply another disturbance, and a controller designed
with disturbance rejection in mind will be more than capable of coping.

The inertia tensor is assumed to be fixed. In truth, movement of the control
mass changes the relative positioning of the masses of the system, resulting in
changes to the inertia tensor. Such changes affect the absolute and relative
magnitudes of the effect of external forces on the angle-rates of the craft.
Further, changes to the inertia tensor in the absence of torques will tend to
cause changes to the angle-rates as angular momentum is conserved. None of these
effects are accounted for in the model, again opting to consider these as plant
uncertainties, a variety of disturbance, which will be adequately rejected by a
suitable controller.

\subsection{External Forces}

With the omission of internal forces from the dynamics, only two forces remain
that act on the craft: aerodynamic and gravitational.

Gravitational force is constant and acts downward, through the center of mass at
all times. Aerodynamic force varies in magnitude and center of action as a
function of speed and orientation, but can be decomposed into drag force, lift
force, and pitching moment. These act along the axes of the aerodynamic frame,
defined using the wind direction and the wing axis, and centered about the
center of gravity of the wing \cite{etkin}. These are translated to forces and
moments acting about the center of mass of the craft to give a consistent set of
equations that describe the forces acting on the craft.

\begin{eqnarray*}
\Sigma \vec{F} &=& \vec{F_g} + \vec{F_L} + \vec{F_D} + \vec{F_p} \\
\Sigma \vec{M} &=& \vec{M_p} + \vec{M_L} + \vec{M_D} \\
\vec{F_g} &=& -mg\hat{k} \\
\vec{F_L} &=& C_L(\alpha) \frac{\rho v^2 S}{2}\hat{e}_{aero,z} \\
\vec{F_D} &=& -(C_D(\alpha) + \frac{C_L(\alpha)^2}{\pi e \frac{S}{c}})\frac{\rho v^2 S}{2}\hat{e}_{aero,x} \\
\vec{M_p} &=& C_m(\alpha) \frac{\rho v^2 S c}{2} \hat{e}_{aero,y} \\
\vec{F_p} &=& \frac{M_p}{| \vec{r_{cw}} \times \hat{e}_{aero,y} |} \
    \frac{\hat{e}_{cw} \times \hat{e}_{aero,y}}{|\hat{e}_{cw} \times \hat{e}_{aero,y}|} \\
\vec{M_L} &=& \vec{F_L} \times \vec{r_{cw}} \\
\vec{M_D} &=& \vec{F_D} \times \vec{r_{cw}} \\
\end{eqnarray*}

\subsection{Resultant Motion}

The effect the external forces have on the craft are described by the
Newton-Euler equations.

\begin{eqnarray*}
\vec{a} &=& m^{-1} \Sigma \vec{F} \\
\vec{\alpha} &=& \textbf{I}^{-1}(\Sigma \vec{M} - \omega \times \textbf{I} \omega) \\
\end{eqnarray*}

These equations for linear and angular acceleration can be integrated to obtain
linear velocity, position, and angular velocity; however, orientation is tracked
using Euler angles, the rates of which must be translated from angular velocity
before integration.

\begin{displaymath}
\left[ \begin{matrix}
\dot{\psi} \\
\dot{\theta} \\
\dot{\phi}
\end{matrix} \right] = \left[ \begin{matrix}
0 & -\sin \psi &  \cos \theta \cos \psi \\
0 &  \cos \psi &  \cos \theta \sin \psi \\
1 & 0          & -\sin \psi
\end{matrix} \right] ^{-1} \vec{\omega}
\end{displaymath}

\section{Controller Design}

The controller must keep the craft flying stably while simultaneously attempting
to navigate to its destination.  This means it must prevent the craft from
attaining unstable attitudes, both those of pitch, and of roll.  While
maintaining stable flight, the controller must adjust the craft's heading in
order to follow a smooth flightplan towards its objective.  The design of the
controller was separated into inner and outer loops, each operating in a
different reference frame, to simplify the design of each aspect of the control
system.  The ultimate goal of the outer-loop controller is to designate a
flightplan for the inner-loop controller to match; hence, it will be referred to
as the Path Planner.

%TODO: block diagram of control scheme.
\begin{figure}[h!]
    \caption{Top-Level Control Scheme}
    \centering
    \includegraphics[height=1in,width=3.5in]{flowchart.eps}
    \label{fig:flowchart}
\end{figure}

The outer-loop controller must handle the non-linearity of rotations within 3
dimensions and balance multiple objectives. Linear control schemes are
unsuitable to this variety of problem. In stead, a modified gradient-descent minimization 
is run on an objective function that is piecewise defined by the state of the
craft. The priorities of this system are to reduce pitch if it exceeds
$45^{\circ}$ from horizontal, reduce angles of attack and sideslip if their
combined magnitude exceeds $45^{\circ}$, and lastly to minimize the difference
between the craft's current heading and the direction to the objective.

To avoid destabilizing the craft, the offset of the target heading to the
current heading is limited by running only a single step of this gradient
minimization in stead of running to completion. While this does not find the
optimal desired orientation immediatly, the craft's convergence on the target
heading will act to cause the target to converge towards the local minimum.

The inner-loop controller was designed around the linearization of craft
dynamics provided by \cite{spottiswoode}.  For the purposes of the simulation,
all state variables are directly measurable.  A physical implementation would
not share this property, and so an observer would have to be designed to
estimate state.  However, the Separation Principle assures us that the
controller design is independant of the observer design, so the controller
designed here can be augmented with an observer later if the prototype is
actually built.  In the meantime, limiting the design to stabilization and
heading tracking simplifies the design.

\subsection{Performance Requirements}

Several considerations compete when establishing performance requirements for
the control system.  The craft must stay near the linearization point for the
model to remain accurate.  The control signal must remain within regions of
physical operation; since it corresponds to spherical coordinates of the control
mass, the horizontal plane serves as an extreme limit for absolute displacements
(in other words, the angular positions of the control mass are limited to at
most $\pm \pi/2$).  Therefore, the need for responses fast enough to stabilize
the craft compete with the need to keep control signals small.

In order to establish specifications for the controller to meet, the open-loop
system was simulated (i.e., the glider with identically zero control input) and
measurements were made to determine how quickly the system diverged from the
linearization point.  Physical limits of craft behaviour were also specified.
The specifications arrived at are summarized in Table~\ref{tab:specs}.

%TODO: come up with performance requirements.
%TODO: should we move performance requirements to Results?
\begin{table}[b]
    \centering
    \begin{tabular}{|c|}
        hmm
    \end{tabular}
    \caption{Performance specifications}
    \label{tab:specs}
\end{table}

\subsection{Path Planner Design}
%TODO: talk about goals, prioritization, gradient descent, etc.

\subsection{Linear Quadratic Regulation}
The control design methodology used for the inner-loop controller was that of
linear quadratic regulation.  In order to achieve perfect steady-state step
tracking, the system state was augmented with integrals of the output error (see
(\ref{eqn:z})).  No additional design complexity is required for perfect
steady-state step tracking.  Linear feedback (see (\ref{eqn:ctrllaw})) is
designed to optimize a quadratic cost function (see (\ref{eqn:cost})).  The
design parameters $Q$ and $R$ are chosen and iteratively refined in order to
meet the performance requirements.  The final values for $Q$, $R$, and $K$ are
given in Chapter~\ref{sec:results}.

\begin{equation}
    z = \int\limits_0^t r(t) - y(t) \; \textrm{d}t
    \label{eqn:z}
\end{equation}

\begin{equation}
    u
    =
    -
    \begin{pmatrix}
        K_{state} & K_{ref}
    \end{pmatrix}
    \begin{pmatrix}
        x \\ z
    \end{pmatrix}
    \label{eqn:ctrllaw}
\end{equation}

\begin{equation}
    J(u) = \int\limits_0^\infty x^T(t)Qx(t) + u^T(t)Ru(t) \; \textrm{d}t
    \label{eqn:cost}
\end{equation}

\section{Simulation}
\label{sec:simulation}
In order to implement a simulation of the craft dynamics arrived at in
Section~\ref{sec:modelling}, a numerical approach was used.  Initial results
using a nested 4th/5th order Runge-Kutta method\footnote{Implemented using
MATLAB's \texttt{ode45}.} were numerically unstable.  Since there are non-linear
components in the system, notably the path planner, the behaviour of the system
will change more rapidly in some states than in others.  This can cause the
integration error in the RK solution to increase rapidly, forcing extremely
small step sizes.  Due to practical considerations, a faster simulation was
desired.

A stiff solver\footnote{Implemented using MATLAB's \texttt{ode15s}.} was used to
improve simulation runtimes.  The solver uses nested 1st/5th order techniques
implemented using the implicit method of backward differences, allowing much
greater timesteps \cite{SR97}.  Furthermore, the solver uses strategies to
minimize the frequency with which estimates of the problem's Jacobian matrix
must be calculated, further accelerating solution runtimes.

\chapter{Results and Discussion}
\label{sec:results}
% Final results must be presented based on your design or testing of your
% design.  Results should indicate the efficacy of your design efforts with
% respect to the objectives.

%TODO: discuss control analysis, e.g. controllability, PBH tests, etc.
%TODO: detail final design parameters
\begin{table}
    \centering
    \begin{tabular}{|c|}
        hmm
    \end{tabular}
    \caption{Final controller design parameters}
    \label{tab:ctrlparams}
\end{table}

\section{Maintain Flight}

The controller acts to destabilize the craft when it tries to perform banking
turns. In this respect, the objective is not yet met.

\section{Fly to Target}

Owing to its inability to perform bank turns, and also to its inability to steer
descent angle away from a hard-coded value; it is impossible to argue that the
controller steers towards the target.

\section{Land Safely}

Lacking the plans for the WRT's glider, it was not possible to determine
acceptible bounds on the landing conditions. The alternate glider parameters
used did not contain sufficient detail to estimate these for that craft either.
Due to this lack of information and timeline overruns elsewhere, plans for
accomodating landing requirements were scrapped.

\chapter{Conclusions and Recommendations}
% You must provide a clear, succinct account of your contributions to the design
% and solution of the identified problem.  Shortcomings should be identified
% (nothing is ever perfect!).  Future recommendations must be provided and can
% (if appropriate) be formulated as a basis for a future Systems Design
% workshop.
Due to external factors, as well as the ambitious nature of the project, some
contractions in scope were required.  As the actual glider to be built for the
WRT was not constructed and its plans were never obtained, a model for another
hang glider was substituted.  This model was derived using physical principles
and simulated using numerical methods (cf. Sections \ref{sec:modelling},
\ref{sec:simulation}).  The objectives given in Sections \ref{sec:obj1} and
\ref{sec:obj2} were considered and designed for.

Nonlinear simulations confirmed the inherent stability of the craft to pitch
disturbances, although modelling difficulties prevented applying the designed
controller to the simulated craft.  Analysis of the controller on the linearized
model shows that the derived performance requirements were met, despite
competing requirements in, for example, the roll response.

\section{Recommendations}
The greatest shortcoming of the design at the moment is the difficulty in
calculating certain steady-state flight characteristics for any given state,
preventing the integration of the controller in the nonlinear simulation.  If
this can be overcome, then the controller can be simulated in a fuller
context and evaluated to determine whether the objectives of the controller
design have been met.

If the Waterloo Rocketry Team still desires an autonomous hang glider to deploy
from their rocket in a future competition, then craft plans must be provided to
replace the model from \cite{spottiswoode} with one corresponding to the actual
craft.  Experimental testing, potentially involving either a scale model in a
wind tunnel or a full model in free flight, should be used to refine the model.
With the improved and validated model in hand, the controller design presented
here should be re-evaluated, especially with regards to performance
specifications.  Finally, the redesigned controller can be simulated and
validated with free-flight testing.

\appendix

\chapter{Timeline}
% Provide a copy of your original timeline and a description of how well you met
% the objectives initially projected.  Provide an explanation for situations
% where the timeline requirements were not met.  This information is best placed
% in an Appendix.


Aggressive timeline, poor implementation decisions, and dependence on external
cooperation all contributed to the need for reduction in scope of the initial
plan.

At the outset of the project, the group was lacking the skills and insights,
particularly into dynamics and control theory. These were learned by group
members as required to complete their tasks. The plan did not account for the
time taken in learning and associated naive mistakes.

Several suboptimal decisions were made regarding implementation strategy. One
salient example is the failure to invest in a $3^{rd}$ party physics simulation
system. These decisions led to much additional work, such as debugging a
home-grown physics simulation system, only tangential to the objectives.

The project was initially framed in the context of the UW Rocketry Team's needs.
However, the glider's mechanical design has yet to be made available to the team or
this project. Additionally, both engine tests run by the team to date have
resulted in destructive failures. Lacking parameters for the glider, a prototype
of the glider, engine force and noise characteristics, or a rocket to use in
test flights; many of the scheduled activities cannot be accomplished.

The initial timeline, as well as its current state of completion, is summarized
bellow.

\begin{longtable} { c p{2.5in}@{ } c c c } 
    \hline
    Month & Task & Status & Andrew & Peter \\
    \hline
    Sep
        & Identify task & Completed & \checkmark & \checkmark \\
        & Identify important unknowns & Completed & \checkmark & \checkmark \\
        & Research wing dynamics & Completed & \checkmark & \checkmark \\
        & Obtain prior art & Completed & \checkmark & \\
    \hline
    Oct
        & Design Plan & Completed & \checkmark \\
        & Glider component breakdown & Completed & \checkmark & \\
        & Glider team PDR & Completed & \checkmark & \checkmark \\
        & Glider stable flight model & Completed & & \checkmark \\
        & Actuator and sensor selection & Abandoned & \checkmark & \\
    \hline
    Nov
        & Actuator and sensor parts acquisition & Abandoned & \checkmark & \\
        & Glider deployment strategy & Adopted by WRT & & \checkmark \\
        & Actuator and sensor testing & Abandoned & \checkmark & \\
        & Steady flight controller design & Partially Completed & \checkmark & \\
    \hline
    Dec
        & Glider mechanical design completed and presented (external) & Not Done & & \\
        & Website Summary & Completed & & \checkmark \\
        & Interim Progress Report & Completed & \checkmark & \\
    \hline
    Jan
        & WRT engine tests (external) & Failed & & \\
        & Steady flight controller design (continued) & Partially Completed & \checkmark & \\
        & Adjustment/augmentation of & Adopted by WRT & \checkmark & \\
            & controller for deployment task  \\
        & Rocket flight vibration modeling & Abandoned & & \checkmark \\
    \hline
    Feb
        & WRT test flight (external) & Postponed & & \\
        & Controller parts acquisition & Abandoned & \checkmark & \\
        & Rocket flight shock/forces modeling & Abandoned & & \checkmark \\
    \hline
    Mar
        & Assembly & Abandoned & \checkmark & \checkmark \\
        & Glider test flight & Abandoned & \checkmark & \checkmark \\
        & 2 week buffer & & & \\
    \hline
    Apr
        & Final Report & Ongoing & \checkmark & \checkmark \\
        & Conference Summary & Ongoing & \checkmark & \checkmark \\
        & Project Video & Ongoing & \checkmark & \checkmark \\
        & Symposium Presentation Materials & Completed & \checkmark & \checkmark \\
        & Symposium & Completed & \checkmark & \checkmark \\
    \hline
    Jun
        & Intercollegiate Rocket \\
            & Engineering Competition & & \checkmark & \checkmark \\
    \hline
\end{longtable}

\bibliography{syde460final}

\end{document}
